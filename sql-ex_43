/*
    Find the ships that `survived for future battles`; that is, after being damaged in a battle, they participated in another one, which occurred later.
*/

WITH nb AS
  (SELECT o.ship ,
          o.result ,
          LEAD(o.result) OVER(PARTITION BY ship
                              ORDER BY b.date) AS next_battle_data
   FROM outcomes AS o
   LEFT JOIN battles AS b ON o.battle = b.name)

SELECT DISTINCT ship
FROM nb
WHERE result = 'damaged'
  AND next_battle_data IS NOT NULL
